# Fashion AI Engine 开发路线图

> 最后更新: 2024-12-19

## 产品愿景

打造服装电商全自动化营销流水线：**商品图 → 模特试穿图 → 短视频营销内容**

---

## 阶段概览

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Phase 0   │     │   Phase 1   │     │   Phase 2   │     │   Phase 3   │
│   基础架构   │ ──▶ │  模特图生成  │ ──▶ │  视频生成   │ ──▶ │  完整流水线  │
│   ✅ 已完成  │     │  🔄 进行中   │     │  📋 待开始  │     │  📋 待开始  │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

---

## Phase 0: 基础架构 ✅

**状态**: 已完成

### 已实现功能
- [x] Next.js 15 + App Router 项目框架
- [x] Vercel AI SDK + OpenRouter 集成
- [x] 营销脚本生成 (Gemini 2.0 Flash)
- [x] Supabase 数据库 Schema 设计
- [x] 基础 UI 界面

### 交付物
- `src/app/actions.ts` - Server Actions
- `src/lib/ai-config.ts` - AI 配置
- `supabase_schema.sql` - 数据库结构

---

## Phase 1: 模特图生成 🔄

**状态**: 待开始
**目标**: 用户上传商品平铺图 → 生成模特试穿效果图

### 1.1 技术选型

| 方案 | 提供商 | 优势 | 劣势 |
|------|--------|------|------|
| **VTON API** | SiliconFlow / Replicate | 专业试穿效果 | 需要单独对接 |
| **Flux + ControlNet** | OpenRouter / RunPod | 灵活可控 | 需要 Prompt 工程 |
| **Kolors VTON** | 快手开源 | 免费、效果好 | 需自建推理服务 |

**推荐**: SiliconFlow VTON API (快速验证) 或 Kolors (成本最优)

### 1.2 核心功能
- [ ] 图片上传接口 (Supabase Storage / R2)
- [ ] VTON API 对接
- [ ] 异步任务队列 (generations 表状态管理)
- [ ] 生成结果展示 UI

### 1.3 架构调整
```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   上传图片   │ ──▶ │  创建任务    │ ──▶ │  轮询状态    │
│   前端组件   │     │  Server Action│     │  获取结果    │
└──────────────┘     └──────────────┘     └──────────────┘
                            │
                            ▼
                     ┌──────────────┐
                     │  VTON API    │
                     │  (异步调用)   │
                     └──────────────┘
```

### 1.4 数据库变更
```sql
-- 新增字段
ALTER TABLE generations ADD COLUMN input_image_url TEXT;
ALTER TABLE generations ADD COLUMN model_params JSONB;
```

### 1.5 验收标准
- [ ] 上传商品图后 30 秒内返回模特试穿图
- [ ] 支持多种模特风格选择
- [ ] 图片存储到云端并返回 CDN URL

### 1.6 风险点
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| API 调用超时 | 用户体验差 | 异步队列 + 进度提示 |
| 生成质量不稳定 | 商业可用性 | 多模型备份 + 人工筛选 |
| 成本超预算 | 商业模式 | 设置生成次数限制 |

---

## Phase 2: 视频生成 📋

**状态**: 待开始
**目标**: 输入脚本文案 + 模特图 → 生成数字人营销视频

### 2.1 技术选型

| 方案 | 说明 | 成本 |
|------|------|------|
| **InfiniteTalk API** | infinitetalk.net 托管服务 | 按次付费 |
| **自建 InfiniteTalk** | RunPod 部署开源模型 | $0.4-0.6/小时 |
| **Hedra / HeyGen** | 商业 API | 较高 |

**推荐**: 初期用 InfiniteTalk API，验证后自建降本

### 2.2 核心功能
- [ ] TTS 文本转语音 (Azure / 阿里云)
- [ ] InfiniteTalk API 对接
- [ ] 视频任务异步处理
- [ ] 视频播放器 UI

### 2.3 架构调整
```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  脚本 + 图片 │ ──▶ │   TTS 转语音 │ ──▶ │ InfiniteTalk │
│              │     │              │     │  视频合成    │
└──────────────┘     └──────────────┘     └──────────────┘
                                                 │
                                                 ▼
                                          ┌──────────────┐
                                          │  CDN 存储    │
                                          │  视频分发    │
                                          └──────────────┘
```

### 2.4 验收标准
- [ ] 30 秒脚本在 2 分钟内生成视频
- [ ] 支持 480p/720p 分辨率选择
- [ ] 视频可下载、可预览

---

## Phase 3: 完整流水线 📋

**状态**: 待开始
**目标**: 一键完成 商品图 → 模特图 → 视频 的全自动化

### 3.1 核心功能
- [ ] 工作流编排 (模特图完成后自动触发视频生成)
- [ ] 批量处理能力
- [ ] 进度追踪 Dashboard
- [ ] 结果导出 (视频 + 脚本 + 封面)

### 3.2 架构调整
```
┌───────────────────────────────────────────────────────────┐
│                    Workflow Engine                        │
│  ┌─────────┐     ┌─────────┐     ┌─────────┐            │
│  │ Step 1  │ ──▶ │ Step 2  │ ──▶ │ Step 3  │            │
│  │ 模特图  │     │  脚本   │     │  视频   │            │
│  └─────────┘     └─────────┘     └─────────┘            │
└───────────────────────────────────────────────────────────┘
```

**技术选项**:
- Inngest (Serverless 工作流)
- Trigger.dev (开源替代)
- 自建状态机

### 3.3 验收标准
- [ ] 上传商品图后 5 分钟内完成全流程
- [ ] 支持同时处理多个商品
- [ ] 失败步骤可重试

---

## 技术债务清单

在推进新功能前，建议先修复：

| 优先级 | 问题 | 影响范围 |
|--------|------|----------|
| P0 | 输入验证缺失 | 安全性 |
| P0 | 环境变量未校验 | 可靠性 |
| P1 | RLS 与代码不匹配 | 数据写入失败 |
| P1 | 缺少错误反馈 UI | 用户体验 |
| P2 | 类型定义缺失 | 可维护性 |

---

## 里程碑时间线

| 里程碑 | 目标 | 关键依赖 |
|--------|------|----------|
| M1 | Phase 1 完成 | VTON API 对接 |
| M2 | Phase 2 完成 | TTS + InfiniteTalk |
| M3 | Phase 3 完成 | 工作流引擎 |
| M4 | 公开发布 | 用户认证 + 计费 |

---

## 附录

### A. 相关文档
- [InfiniteTalk 技术分析](../InfiniteTalk_Technical_Analysis.md)
- [InfiniteTalk 商业可行性报告](../InfiniteTalk_Commercial_Viability_Report.md)

### B. API 参考
- OpenRouter: https://openrouter.ai/docs
- SiliconFlow: https://siliconflow.cn/docs
- InfiniteTalk: https://github.com/MeiGen-AI/InfiniteTalk
